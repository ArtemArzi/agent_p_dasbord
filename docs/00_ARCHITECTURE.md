# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã Agent P Dashboard

## 1. –í–∏–¥–µ–Ω–∏–µ

Agent P Dashboard ‚Äî —ç—Ç–æ **–ø—É–Ω–∫—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ —Å–∞–ª–æ–Ω–æ–≤ –∫—Ä–∞—Å–æ—Ç—ã. –î–∞—à–±–æ—Ä–¥ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã Agent P –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –µ–¥–∏–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                       AGENT P ECOSYSTEM                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ   ü§ñ Agent P (Bot)          üìä Dashboard            üì± Mini App      ‚îÇ
‚îÇ   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ         ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ           ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ     ‚îÇ
‚îÇ   Python / Aiogram          Python / NiceGUI        React / TG SDK  ‚îÇ
‚îÇ   –ö–ª–∏–µ–Ω—Ç—ã (Chat)            –ê–¥–º–∏–Ω (Web)             –ö–ª–∏–µ–Ω—Ç—ã (GUI)   ‚îÇ
‚îÇ   ‚úÖ Production             üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ          üìù Deferred     ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 2. –ö–ª—é—á–µ–≤–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è: Python Native Ecosystem

–ú—ã –≤—ã–±–∏—Ä–∞–µ–º **NiceGUI** (–Ω–∞ –±–∞–∑–µ FastAPI) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–∞.

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| **–Ø–∑—ã–∫** | Python 3.11+ (–µ–¥–∏–Ω—ã–π —Å—Ç–µ–∫ —Å –±–æ—Ç–æ–º) |
| **UI Framework** | NiceGUI (Quasar/Material components) |
| **Backend** | FastAPI (–≤—Å—Ç—Ä–æ–µ–Ω –≤ NiceGUI) |
| **Database** | Supabase (PostgreSQL) |
| **Auth** | Supabase Auth + —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ users |
| **Realtime** | Supabase Realtime (WebSockets) |
| **Deploy** | Docker + Coolify |

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ NiceGUI

| –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------------|----------|
| üöÄ **–°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** | UI –ø–∏—à–µ—Ç—Å—è –∫–∞–∫ Python-–∫–æ–¥, —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ SPA |
| üîÑ **–ï–¥–∏–Ω—ã–π —Å—Ç–µ–∫** | –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º Pydantic –º–æ–¥–µ–ª–∏, ORM, —É—Ç–∏–ª–∏—Ç—ã –∏–∑ –±–æ—Ç–∞ |
| üîå **Realtime –∏–∑ –∫–æ—Ä–æ–±–∫–∏** | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ WebSockets –¥–ª—è "–∂–∏–≤—ã—Ö" –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π |
| üíé **–ì–æ—Ç–æ–≤—ã–π UI Kit** | Material Design –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (cards, tables, charts) |
| üêç **Python-only** | –ù–µ –Ω—É–∂–µ–Ω JavaScript/React –¥–ª—è MVP |

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```mermaid
flowchart TD
    subgraph "–í—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫"
        TG[Telegram Users]
        WEB[Web Users / Admins]
    end

    subgraph "Agent P Bot"
        BOT[FastAPI + LangGraph]
        BOT --> |"WRITE"| PUB[(public.*)]
    end

    subgraph "Dashboard"
        DASH[NiceGUI App]
        DASH --> |"READ"| PUB
        DASH --> |"READ/WRITE"| DSH[(dashboard.*)]
    end

    subgraph "Supabase"
        PUB
        DSH
        AUTH[Supabase Auth]
    end

    TG --> BOT
    WEB --> DASH
    DASH --> AUTH
```

---

## 4. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

### 4.1 Agent P (Bot) ‚Äî –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–∏—Å—Ç

**–ó–æ–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ YClients API
- –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤ `public.*`

**–¢–∞–±–ª–∏—Ü—ã (WRITE):**
- `active_sessions_v2` ‚Äî –≥–æ—Ä—è—á–∏–µ —Å–µ—Å—Å–∏–∏
- `conversation_sessions_v2` ‚Äî –∞—Ä—Ö–∏–≤ –¥–∏–∞–ª–æ–≥–æ–≤
- `clients_v2` ‚Äî –ø—Ä–æ—Ñ–∏–ª–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- `wishlist_v2` ‚Äî –ª–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è
- `user_ltm_v2` ‚Äî –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å

### 4.2 Dashboard ‚Äî –ü—É–Ω–∫—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ó–æ–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ KPI
- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∏–∞–ª–æ–≥–æ–≤ –±–æ—Ç–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏—Å—Ç–æ–º –æ–∂–∏–¥–∞–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–Ω–∞–Ω—Ç–æ–≤

**–¢–∞–±–ª–∏—Ü—ã:**
- `public.*` ‚Äî **READ ONLY** (–¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞)
- `dashboard.*` ‚Äî **READ/WRITE** (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

### 4.3 Mini App ‚Äî –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞

> [!NOTE]
> **DEFERRED** ‚Äî –æ—Ç–ª–æ–∂–µ–Ω–æ –¥–æ Phase 3. –°–º. [07_PHASE3_MINIAPP.md](./07_PHASE3_MINIAPP.md)

---

## 5. –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 5.1 –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ (Bot ‚Üí Dashboard)

```
[–ö–ª–∏–µ–Ω—Ç] ‚Üí [Telegram] ‚Üí [Agent P Bot]
                              ‚Üì
                        [Supabase public.*]
                              ‚Üì
                        [Dashboard] ‚Üê [–ê–¥–º–∏–Ω]
```

1. –ö–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç –±–æ—Ç—É –≤ Telegram
2. Bot –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `public.*`
3. Dashboard —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É
4. –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –¥–∏–∞–ª–æ–≥–∏, wishlist

### 5.2 –£–ø—Ä–∞–≤–ª—è—é—â–∏–π –ø–æ—Ç–æ–∫ (Dashboard ‚Üí Bot)

```
[–ê–¥–º–∏–Ω] ‚Üí [Dashboard] ‚Üí [Supabase dashboard.*]
                              ‚Üì
                        [Prefect Job / Webhook]
                              ‚Üì
                        [Agent P Bot] ‚Üí [Telegram]
```

1. –ê–¥–º–∏–Ω –∏–∑–º–µ–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ä–∞—Å—Å—ã–ª–∫—É
2. Dashboard –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ `dashboard.*`
3. Prefect Job –∏–ª–∏ Webhook —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –±–æ—Ç–∞
4. Bot –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É

---

## 6. –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 6.1 Single Source of Truth

- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Supabase
- Dashboard **–Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç** –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞
- –ú–µ—Ç—Ä–∏–∫–∏ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ SQL Views –∏–ª–∏ Prefect Jobs

### 6.2 Schema Separation

| –°—Ö–µ–º–∞ | –í–ª–∞–¥–µ–ª–µ—Ü | Dashboard –¥–æ—Å—Ç—É–ø |
|-------|----------|------------------|
| `public` | Agent P Bot | READ ONLY |
| `dashboard` | Dashboard | READ/WRITE |

### 6.3 Idempotent Operations

- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ Dashboard –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã

### 6.4 Graceful Degradation

- –ï—Å–ª–∏ Bot –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí Dashboard –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å (read-only —Ä–µ–∂–∏–º)
- –ï—Å–ª–∏ Supabase Realtime –ø–∞–¥–∞–µ—Ç ‚Üí fallback –Ω–∞ polling

---

## 7. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
agent-p-dashboard/
‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ NiceGUI
‚îú‚îÄ‚îÄ config.py               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (env vars)
‚îú‚îÄ‚îÄ auth.py                 # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ middleware
‚îú‚îÄ‚îÄ data.py                 # Supabase queries (Data Access Layer)
‚îú‚îÄ‚îÄ models.py               # Pydantic –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ login.py            # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ overview.py         # üìà –û–±–∑–æ—Ä (KPI, –≤–æ—Ä–æ–Ω–∫–∞)
‚îÇ   ‚îú‚îÄ‚îÄ sessions.py         # üí¨ –î–∏–∞–ª–æ–≥–∏
‚îÇ   ‚îú‚îÄ‚îÄ wishlist.py         # üìã –õ–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ clients.py          # üë• –ö–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ settings.py         # ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–Ω–∞–Ω—Ç–∞
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ sidebar.py          # –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é
‚îÇ   ‚îú‚îÄ‚îÄ kpi_card.py         # –ö–∞—Ä—Ç–æ—á–∫–∞ –º–µ—Ç—Ä–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ chat_viewer.py      # –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∏–∞–ª–æ–≥–∞
‚îÇ   ‚îî‚îÄ‚îÄ funnel_chart.py     # –ì—Ä–∞—Ñ–∏–∫ –≤–æ—Ä–æ–Ω–∫–∏
‚îú‚îÄ‚îÄ jobs/
‚îÇ   ‚îî‚îÄ‚îÄ metrics_collector.py # Prefect job –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îî‚îÄ‚îÄ logo.png
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

---

## 8. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ (–¥–µ—Ç–∞–ª—å–Ω–æ)

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|--------|------------|
| **Runtime** | Python | 3.11+ | –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ |
| **Web Framework** | NiceGUI | 2.x | UI + Server |
| **Async HTTP** | httpx | 0.27+ | Supabase client |
| **Database Client** | supabase-py | 2.x | PostgreSQL access |
| **Data Validation** | Pydantic | 2.x | Models & validation |
| **Charts** | ECharts (via NiceGUI) | - | –ì—Ä–∞—Ñ–∏–∫–∏ |
| **Auth** | bcrypt + JWT | - | Password hashing |
| **Background Jobs** | Prefect | 3.0 | Scheduled tasks |
| **Containerization** | Docker | - | Deployment |

---

## 9. –°–≤—è–∑—å –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

| –î–æ–∫—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| [01_BACKEND.md](./01_BACKEND.md) | Data layer, –º–æ–¥–µ–ª–∏, queries |
| [02_FRONTEND.md](./02_FRONTEND.md) | NiceGUI pages, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã |
| [03_DATABASE.md](./03_DATABASE.md) | –°—Ö–µ–º—ã –ë–î, –º–∏–≥—Ä–∞—Ü–∏–∏ |
| [04_INTEGRATIONS.md](./04_INTEGRATIONS.md) | Supabase, Auth, Realtime |
| [05_PHASE1_MVP.md](./05_PHASE1_MVP.md) | –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω Phase 1 |
| [06_PHASE2_FEATURES.md](./06_PHASE2_FEATURES.md) | Phase 2: —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ |
| [07_PHASE3_MINIAPP.md](./07_PHASE3_MINIAPP.md) | Deferred: Mini App |
